<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Fragalysis API: Pulling Data From Fragalysis</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Fragalysis API
   &#160;<span id="projectnumber">1.1</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Pulling Data From Fragalysis </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Saved in config.ini in top level - default in this repo (go up a folder from here!)</p>
<p><b>[fragalysis]</b> - info about fragalysis deployment to search against</p>
<p>url = url for deployment to search against. Default = fragalysis.diamond.ac.uk</p>
<p><b>[graph]</b> - parameters for searching the graph network</p>
<p>search = restful endpoint (extension of [fragalysis] url) to query the graph network</p>
<p>query = search string in url format for search field to query against. Currently a smiles string</p>
<p><b>[targets]</b> - parameters for querying target (protein) information</p>
<p>search = restful endpoint (extension of [fragalysis] url) to query the fragalysis db for a list of targets</p>
<p>query = search string in url format for search field to query against. Currently the target name</p>
<p><b>[molecules]</b> - parameters for querying molecule (ligand) information</p>
<p>search = search = restful endpoint (extension of [fragalysis] url) to query the fragalysis db for molecule info</p>
<p>query = search string in url format for search field to query against. Currently the target id (to get all related molecules)</p>
<p><b>[pdb]</b> - parameters for getting pdb files</p>
<p>search = search = restful endpoint (extension of [fragalysis] url) to query the fragalysis db for pdb files</p>
<p>query = search string in url format for search field to query against. Currently the code of the target molecule - usually similar to the crystal name from an experiment</p>
<p><b>1. Getting target data</b></p>
<p>First, init an instance of GetTargetsData from fragalysis_preproc/data.py:</p>
<div class="fragment"><div class="line">from data import GetTargetsData</div><div class="line"></div><div class="line">search = GetTargetsData()</div></div><!-- fragment --><p>Next, we need to set a target name that we want to search for. This is done by setting the target_name_url attribute:</p>
<div class="fragment"><div class="line"># e.g. set NUDT5A as the target for the search</div><div class="line">search.set_target_name_url(target=&#39;NUDT5A&#39;)</div></div><!-- fragment --><p>Now, we can get a json response, which gives back the info specified by the fragalysis RESTful api (see &lt;insert documentation="" link="" when="" it="" exists&gt;=""&gt;):</p>
<div class="fragment"><div class="line"># get the json response</div><div class="line">results = search.get_target_json()</div></div><!-- fragment --><p>Finally, we can parse the json with a built-in function to return id's (db id) for the entries relating to the target we searched. We can use this to make further queries to find data in other tables relating to this target:</p>
<div class="fragment"><div class="line"># get a list of integers corresponding to the pk&#39;s for all entries related to the search target</div><div class="line">id_list = search.get_target_id_list()</div></div><!-- fragment --><p><b>2. Getting pdb data - currently apo pdb for given crystal name</b></p>
<p>First, init an instance of GetPdbData from fragalysis_preproc/data.py</p>
<div class="fragment"><div class="line">from data import GetPdbData</div><div class="line"></div><div class="line">search = GetPdbData()</div></div><!-- fragment --><p>Next, we can get a string representation of the PDB file corresponding to the apo structure for the bound-state structure, given an input 'code', i.e. crystal name</p>
<div class="fragment"><div class="line"># get apo pdb for bound-state of NUDT5A-x0123 in string representation</div><div class="line">apo_pdb = search.get_pdb_file(code=&#39;NUDT5A-x0123&#39;)</div></div><!-- fragment --><p><b>3. Getting molecule data - all data relating to molecule from molecule table</b></p>
<p>First, init an instance of GetMoleculesData from fragalysis_preproc/data.py</p>
<div class="fragment"><div class="line">from data import GetMoleculesData</div><div class="line"></div><div class="line">search = GetMoleculesData()</div></div><!-- fragment --><p>Further searches require a target id, which can be found with the api, as shown in point 1. Alternativley, this can be done from the instance we just set up, for a given target name:</p>
<div class="fragment"><div class="line"># get the target id&#39;s for further operations for NUDT5A</div><div class="line">id_list = search.get_target_ids(target=&#39;NUDT5A&#39;)</div></div><!-- fragment --><p>The GetMoleculesData object can either operate on one object at a time, or the entire id list.</p>
<p>Here, I'll show an example that will just cover the first target id in <code>id_list</code></p>
<p>To search the API for moleaules relating to the target id, we need to sett the molecule url:</p>
<div class="fragment"><div class="line"># set the molecule url for the current instance of GetMoleculesData to the first id in the id_list from above</div><div class="line">url = search.set_molecule_url(target_id=id_list[0])</div></div><!-- fragment --><p>Now, we can get the data held in the Molecules table in the fragalysis db in json format (we need to use the returned url from the above snippet. The reason why will become clear later)</p>
<div class="fragment"><div class="line"># get a json response from the url we set above</div><div class="line">results = get_molecules_json(url=url)</div></div><!-- fragment --><p>If we want to operate on all target id's related to a target, we can use a built-in function. Make sure to first set the target_ids parameter with <code>get_target_ids</code> as shown earlier.</p>
<div class="fragment"><div class="line"># get all molecule data (json) related to all of the ids in id_list</div><div class="line">results_table = search.get_all_mol_responses()</div></div><!-- fragment --><p>This returns a pandas dataframe containing: code(crystal name), pdb(apo pdb file as string), sdf(sdf of the bound ligand as string) and smiles(smiles string of the bound ligand)</p>
<p>You can then work on this dataframe however you wish.</p>
<p>Alternativley, there is a script which can be used to download the apo pdb's and sdf files, and a csv file containing the smiles strings for each hit for a given target, as shown in the next section</p>
<p>The script lives in the top level, and is called get_target_data.py</p>
<p>You can see how to run this script with <code>python get_target_data.py --help</code></p>
<p>We can search the graph network currently deployed at the fragalysis deployment specified in config.ini by smiles string</p>
<p>First, we initialise an instance of GraphRequest from fragalysis_preproc/graph.py</p>
<div class="fragment"><div class="line">from graph import GraphRequest</div><div class="line"></div><div class="line">search = GraphRequest()</div></div><!-- fragment --><p>Next, we set the smiles string we want to search</p>
<div class="fragment"><div class="line"># set the search smiles</div><div class="line">search.set_smiles_url(smiles=&#39;O=C(Nc1ccccc1)Nc1cccnc1&#39;)</div></div><!-- fragment --><p>Next, we can get the response from the graph network in json format</p>
<p>``` results = search.get_graph_json()</p>
<p>TODO: convert json reponse from graph into a list of smiles strings for follow up compounds </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
